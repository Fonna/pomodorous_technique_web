<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flip Clock & Pomodoro</title>
    <style>
        :root {
            --bg-color: #202020;
            --card-bg: #333;
            --text-color: #f0f0f0;
            --accent-color: #e74c3c; /* Tomato Red */
            --sidebar-width: 320px;
            --sidebar-bg: #2a2a2a;
            
            /* Card Dimensions */
            --card-width: 225px;
            --card-height: 300px;
            --card-radius: 18px;
            --card-font-size: 180px;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden; 
        }

        h2 {
            margin-bottom: 20px;
            font-weight: normal;
            opacity: 0.8;
        }

        /* --- Overlay (Mask) Styles --- */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black */
            backdrop-filter: blur(5px); /* Background blur */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 90; /* Below sidebar (100) but above clock */
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* --- Flip Clock Styles --- */
        .clock-section {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        .clock-container {
            display: flex;
            gap: 20px;
            perspective: 1000px; /* Essential for 3D effect */
        }

        /* The container for a single digit pair (Hours/Minutes/Seconds) */
        .flip-tick {
            position: relative;
            width: var(--card-width);
            height: var(--card-height);
            border-radius: var(--card-radius);
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
            font-size: var(--card-font-size);
            font-weight: bold;
            line-height: var(--card-height);
            text-align: center;
        }

        /* Common styles for the upper/lower halves */
        .flip-card-inner {
            position: absolute;
            left: 0;
            width: 100%;
            height: 50%;
            background-color: var(--card-bg);
            overflow: hidden;
            backface-visibility: hidden; /* Hide back when rotating */
        }

        /* Top half (Upper) */
        .flip-card-inner.upper {
            top: 0;
            border-top-left-radius: var(--card-radius);
            border-top-right-radius: var(--card-radius);
            transform-origin: 50% 100%; /* Pivot at bottom */
        }
        
        .flip-card-inner.upper span {
            display: block;
            transform: translateY(0%); /* Show top half of text */
        }

        /* Bottom half (Lower) */
        .flip-card-inner.lower {
            bottom: 0;
            border-bottom-left-radius: var(--card-radius);
            border-bottom-right-radius: var(--card-radius);
            transform-origin: 50% 0%; /* Pivot at top */
            /* Ensure line divider appears correctly */
            border-top: 1px solid rgba(0,0,0,0.5); 
        }

        .flip-card-inner.lower span {
            display: block;
            transform: translateY(-50%); /* Shift text up to show bottom half */
        }

        /* Front: Top half of CURRENT number (will rotate down) */
        .flip-tick .front {
            z-index: 3;
            transform: rotateX(0deg);
        }

        /* Back: Bottom half of NEXT number (will rotate up/appear) */
        .flip-tick .back {
            z-index: 2;
            transform: rotateX(180deg); /* Start flipped up */
        }

        /* Static Top: NEXT number (waiting behind Front) */
        .flip-tick .top-static {
            z-index: 1;
        }

        /* Static Bottom: CURRENT number (waiting behind Back, visible after flip starts) */
        .flip-tick .bottom-static {
            z-index: 1;
        }

        /* Animation Classes */
        .flip-down .front {
            animation: flipDownFront 0.6s ease-in-out forwards;
        }

        .flip-down .back {
            animation: flipDownBack 0.6s ease-in-out forwards;
        }

        @keyframes flipDownFront {
            0% { transform: rotateX(0deg); }
            100% { transform: rotateX(-180deg); }
        }

        @keyframes flipDownBack {
            0% { transform: rotateX(180deg); }
            100% { transform: rotateX(0deg); }
        }


        /* --- Sidebar & Pomodoro Tool Styles --- */
        .sidebar {
            position: fixed;
            top: 0;
            right: calc(var(--sidebar-width) * -1); 
            width: var(--sidebar-width);
            height: 100%;
            background-color: var(--sidebar-bg);
            box-shadow: -5px 0 15px rgba(0,0,0,0.5);
            transition: right 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .sidebar.open {
            right: 0;
        }

        .sidebar-toggle {
            position: absolute;
            left: -50px; 
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 100px; 
            background-color: var(--sidebar-bg);
            border-top-left-radius: 10px;
            border-bottom-left-radius: 10px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: -2px 0 5px rgba(0,0,0,0.3);
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-weight: bold;
            user-select: none;
            color: var(--accent-color);
        }
        
        .sidebar-toggle .arrow {
            font-size: 20px;
            margin-bottom: 5px;
            writing-mode: horizontal-tb; 
        }

        .sidebar-toggle:hover {
            background-color: #383838;
        }

        .pomodoro-section {
            background: transparent;
            padding: 20px;
            border-radius: 0;
            border: none;
            width: 100%;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .timer-display {
            font-size: 48px;
            margin: 20px 0;
            color: var(--accent-color);
            font-weight: bold;
        }

        /* Presets Container */
        .presets {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .preset-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #aaa;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .preset-btn:hover {
            border-color: #fff;
            color: #fff;
        }

        .preset-btn.active {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: #fff;
        }

        /* Custom Input Group */
        .custom-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            align-items: center;
        }

        .custom-input-group input {
            width: 60px;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(0,0,0,0.2);
            color: #fff;
            text-align: center;
            font-family: inherit;
        }

        /* Remove arrows from number input */
        .custom-input-group input::-webkit-outer-spin-button,
        .custom-input-group input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .custom-input-group button {
            padding: 5px 15px;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .custom-input-group button:hover {
            background: rgba(255,255,255,0.1);
            border-color: #fff;
        }

        .controls button {
            background-color: transparent;
            border: 2px solid var(--text-color);
            color: var(--text-color);
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }

        .controls button:hover {
            background-color: var(--text-color);
            color: var(--bg-color);
        }

        .controls button.primary {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        .controls button.primary:hover {
            background-color: var(--accent-color);
            color: white;
        }

        /* --- Fullscreen Button --- */
        .fullscreen-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.6);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 50;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .fullscreen-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .fullscreen-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        /* --- Floating Mute Button --- */
        .mute-btn-floating {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px); /* Increased blur */
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.6);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 50;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .mute-btn-floating:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        /* --- Progress Bar Styles --- */
        .progress-line-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.05);
            z-index: 40;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .progress-line-container.active {
            opacity: 1;
        }

        .progress-line-fill {
            height: 100%;
            background: var(--accent-color);
            width: 0%;
            transition: width 1s linear;
            box-shadow: 0 0 10px var(--accent-color);
        }

        /* Hide Sidebar Toggle and Fullscreen Button in Fullscreen Mode */
        body.fullscreen-mode .sidebar-toggle,
        body.fullscreen-mode .sidebar,
        body.fullscreen-mode .fullscreen-btn,
        body.fullscreen-mode .mute-btn-floating {
            display: none;
        }

    </style>
</head>
<body>

    <!-- Background Overlay -->
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <!-- Mute Button (Main Page) -->
    <button onclick="toggleMute()" id="muteBtn" class="mute-btn-floating" title="Mute">üîä</button>

    <div class="clock-section">
        <div class="clock-container">
            <!-- Template will be generated by JS -->
            <div class="flip-tick" id="tick-hours"></div>
            <div class="flip-tick" id="tick-minutes"></div>
            <div class="flip-tick" id="tick-seconds"></div>
        </div>
    </div>

    <!-- Sidebar Structure -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
            <span class="arrow" id="toggleArrow">‚ùÆ</span>
            <span>Tools</span>
        </div>
        
        <div class="pomodoro-section">
            <h2>üçÖ Pomodoro</h2>
            
            <!-- Preset Buttons -->
            <div class="presets">
                <button class="preset-btn active" onclick="setMode(25, this)" id="btn-focus">Focus</button>
                <button class="preset-btn" onclick="setMode(5, this)" id="btn-short">Short Break</button>
                <button class="preset-btn" onclick="setMode(15, this)" id="btn-long">Long Break</button>
            </div>

            <!-- Custom Input -->
            <div class="custom-input-group">
                <input type="number" id="customMin" placeholder="Min" min="1" max="180">
                <button onclick="setCustomTime()">Set Custom</button>
            </div>

            <div class="timer-display" id="pomo-timer">25:00</div>
            <div class="controls">
                <button class="primary" onclick="startTimer()" id="startBtn">Start</button>
                <button onclick="resetTimer()">Reset</button>
            </div>
            <p id="status-text" style="font-size: 12px; color: #888; margin-top: 15px;">Ready to focus?</p>
        </div>
    </div>

    <!-- Fullscreen Button -->
    <button class="fullscreen-btn" onclick="toggleFullScreen()" title="Toggle Fullscreen">
        <svg viewBox="0 0 24 24">
            <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
        </svg>
    </button>

    <!-- Progress Bar -->
    <div class="progress-line-container" id="progressContainer">
        <div class="progress-line-fill" id="progressBar"></div>
    </div>

    <script>
        // --- Fullscreen Logic ---
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch((err) => {
                    console.error(`Error attempting to enable fullscreen: ${err.message}`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        // Listen for fullscreen change events (covers Esc key too)
        document.addEventListener('fullscreenchange', () => {
            const sidebar = document.getElementById('sidebar');
            const arrow = document.getElementById('toggleArrow');
            const overlay = document.getElementById('overlay');
            
            if (document.fullscreenElement) {
                document.body.classList.add('fullscreen-mode');
                // Auto-close sidebar when entering fullscreen
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
                arrow.innerText = '‚ùÆ';
            } else {
                document.body.classList.remove('fullscreen-mode');
            }
        });

        // --- Sidebar Logic ---
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const arrow = document.getElementById('toggleArrow');
            const overlay = document.getElementById('overlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
            
            if (sidebar.classList.contains('open')) {
                arrow.innerText = '‚ùØ';
            } else {
                arrow.innerText = '‚ùÆ';
            }
        }

        // --- 1. Advanced 3D Flip Clock Logic ---

        // Helper to create the HTML structure for a single flip unit
        function createFlipUnit(element, initialValue) {
            // Upper Static (Next value top)
            // Lower Static (Current value bottom)
            // Front (Current value top, animates)
            // Back (Next value bottom, animates)
            
            // Note: In a real flip, we have:
            // 1. Static Top (shows Next)
            // 2. Static Bottom (shows Current)
            // 3. Flipper Front (shows Current Top) -> Rotates Down
            // 4. Flipper Back (shows Next Bottom) -> Rotates Up/Down

            element.innerHTML = `
                <div class="flip-card-inner upper top-static"><span>${initialValue}</span></div>
                <div class="flip-card-inner lower bottom-static"><span>${initialValue}</span></div>
                <div class="flip-card-inner upper front"><span>${initialValue}</span></div>
                <div class="flip-card-inner lower back"><span>${initialValue}</span></div>
            `;
            
            // Store current value on the element for comparison
            element.dataset.val = initialValue;
        }

        // Update function for a single unit
        function updateFlipUnit(elementId, newValue) {
            const element = document.getElementById(elementId);
            const currentValue = element.dataset.val;

            if (currentValue === newValue) return;

            // Update DOM logic for animation
            // 1. top-static: Set to New Value
            // 2. bottom-static: Remains Current Value
            // 3. front: Set to Current Value
            // 4. back: Set to New Value
            
            const topStatic = element.querySelector('.top-static span');
            const bottomStatic = element.querySelector('.bottom-static span');
            const front = element.querySelector('.front span');
            const back = element.querySelector('.back span');

            // Prep values
            topStatic.innerText = newValue;
            bottomStatic.innerText = currentValue;
            front.innerText = currentValue;
            back.innerText = newValue;

            // Trigger Animation
            // Remove class to reset if needed (though we usually wait)
            element.classList.remove('flip-down');
            // Force reflow
            void element.offsetWidth; 
            element.classList.add('flip-down');

            // After animation ends, update "current" state
            // timeout matches CSS animation duration (0.6s)
            setTimeout(() => {
                element.classList.remove('flip-down');
                bottomStatic.innerText = newValue; 
                front.innerText = newValue; 
                element.dataset.val = newValue;
            }, 600);
        }

        function initClock() {
            const now = new Date();
            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            const s = String(now.getSeconds()).padStart(2, '0');

            createFlipUnit(document.getElementById('tick-hours'), h);
            createFlipUnit(document.getElementById('tick-minutes'), m);
            createFlipUnit(document.getElementById('tick-seconds'), s);
        }

        function updateClock() {
            const now = new Date();
            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            const s = String(now.getSeconds()).padStart(2, '0');

            updateFlipUnit('tick-hours', h);
            updateFlipUnit('tick-minutes', m);
            updateFlipUnit('tick-seconds', s);
        }

        initClock();
        setInterval(updateClock, 1000);

        // --- 2. Pomodoro Logic ---
        let timerInterval;
        let currentTotalTime = 25 * 60; // Default total time
        let timeLeft = currentTotalTime; 
        let isRunning = false;

        const timerDisplay = document.getElementById('pomo-timer');
        const startBtn = document.getElementById('startBtn');
        const statusText = document.getElementById('status-text');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        function updateProgressBar() {
            const progress = ((currentTotalTime - timeLeft) / currentTotalTime) * 100;
            progressBar.style.width = `${progress}%`;
        }
        
        function setMode(minutes, btnElement) {
            // Reset existing timer if running
            clearInterval(timerInterval);
            isRunning = false;
            startBtn.innerText = "Start";
            
            // Update time settings
            currentTotalTime = minutes * 60;
            timeLeft = currentTotalTime;
            
            // Update Display
            timerDisplay.innerText = formatTime(timeLeft);
            statusText.innerText = `Switched to ${minutes} min mode.`;
            document.title = "Flip Clock & Pomodoro";
            
            // Reset Progress Bar
            progressContainer.classList.remove('active');
            progressBar.style.width = "0%";
            
            // Update Buttons UI
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            if (btnElement) {
                btnElement.classList.add('active');
            }
        }
        
        function setCustomTime() {
            const input = document.getElementById('customMin');
            const minutes = parseInt(input.value);
            
            if (!isNaN(minutes) && minutes > 0) {
                setMode(minutes, null);
                statusText.innerText = `Switched to custom ${minutes} min mode.`;
            } else {
                alert("Please enter a valid number of minutes.");
            }
        }

        function startTimer() {
            if (isRunning) {
                clearInterval(timerInterval);
                isRunning = false;
                startBtn.innerText = "Resume";
                statusText.innerText = "Paused";
                return;
            }

            // Request Notification Permission on first user interaction
            if ("Notification" in window && Notification.permission === "default") {
                Notification.requestPermission();
            }

            isRunning = true;
            startBtn.innerText = "Pause";
            statusText.innerText = "Focusing...";
            progressContainer.classList.add('active'); // Show progress bar

            timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    timerDisplay.innerText = formatTime(timeLeft);
                    updateProgressBar();
                    document.title = `(${formatTime(timeLeft)}) Focusing`;
                } else {
                    finishTimer();
                }
            }, 1000);
        }

        function resetTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            timeLeft = currentTotalTime; // Reset to currently selected total time
            timerDisplay.innerText = formatTime(timeLeft);
            startBtn.innerText = "Start";
            statusText.innerText = "Ready to focus?";
            document.title = "Flip Clock & Pomodoro";
            
            // Reset Progress Bar
            progressContainer.classList.remove('active');
            progressBar.style.width = "0%";
        }

        function finishTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            timerDisplay.innerText = "00:00";
            statusText.innerText = "üéâ Timer finished! Take a break.";
            startBtn.innerText = "Start";
            document.title = "Time's up!";
            
            // Max out progress bar then hide it
            progressBar.style.width = "100%";
            setTimeout(() => {
                progressContainer.classList.remove('active');
                progressBar.style.width = "0%";
            }, 1000);
            
            playAlert();
            
            // Send Browser Notification
            if ("Notification" in window && Notification.permission === "granted") {
                new Notification("Time's up! üçÖ", {
                    body: "Great job! You've completed your session. Take a well-deserved break.",
                    requireInteraction: true // Keeps notification open until user clicks
                });
            } else {
                // Fallback for no permission
                alert("Time's up! You've completed a session.");
            }
        }

        // --- Mute Logic ---
        let isMuted = false;
        const muteBtn = document.getElementById('muteBtn');

        function toggleMute() {
            isMuted = !isMuted;
            if (isMuted) {
                muteBtn.innerText = "üîá";
                muteBtn.title = "Unmute";
                // Optional: visual indication of off state
                muteBtn.style.opacity = "0.5";
            } else {
                muteBtn.innerText = "üîä";
                muteBtn.title = "Mute";
                muteBtn.style.opacity = "1";
            }
        }

        function playAlert() {
            if (isMuted) return;

            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gainNode = ctx.createGain();

            osc.type = 'sine';
            osc.frequency.value = 880; 
            osc.connect(gainNode);
            gainNode.connect(ctx.destination);
            
            osc.start();
            gainNode.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime + 0.5);
            osc.stop(ctx.currentTime + 0.5);
        }
    </script>
</body>
</html>